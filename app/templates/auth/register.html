{% extends "base_logged_in.html" %}

{% block title %}Register{% endblock %}

{% block content %}
<style>
.valid-input {
    border-color: #28a745 !important;
    background-color: #f8fff8 !important;
}

.invalid-input {
    border-color: #dc3545 !important;
    background-color: #fff8f8 !important;
}

.validation-message {
    font-size: 0.8em;
    margin-top: 5px;
}

.valid-message {
    color: #28a745;
}

.invalid-message {
    color: #dc3545;
}
</style>
<div class="auth-form">
    <h2>Register</h2>
    <form method="post">
        <div class="form-group">
            <label for="username">Username*</label>
            <input type="text" id="username" name="username" required minlength="3" maxlength="20">
            <div id="username-message" class="validation-message"></div>
        </div>
        <div class="form-group">
            <label for="email">Email*</label>
            <input type="email" id="email" name="email" required maxlength="35">
            <div id="email-message" class="validation-message"></div>
        </div>
        <div class="form-group">
            <label for="first_name">First Name*</label>
            <input type="text" id="first_name" name="first_name" required maxlength="50">
        </div>
        <div class="form-group">
            <label for="last_name">Last Name*</label>
            <input type="text" id="last_name" name="last_name" required maxlength="50">
        </div>
        <div class="form-group">
            <label for="address">Address</label>
            <input type="text" id="address" name="address" maxlength="200">
        </div>
        <div class="form-group">
            <label for="phone">Phone Number</label>
            <input type="tel" id="phone" name="phone" maxlength="20">
        </div>
        <div class="form-group">
            <label for="country">Country</label>
            <input type="text" id="country" name="country" maxlength="50">
        </div>
        <div class="form-group">
            <label for="state">State</label>
            <input type="text" id="state" name="state" maxlength="50">
        </div>
        <div class="form-group">
            <label for="city">City</label>
            <input type="text" id="city" name="city" maxlength="50">
        </div>
        <div class="form-group">
            <label for="postal_code">Postal Code</label>
            <input type="text" id="postal_code" name="postal_code" maxlength="20">
        </div>
        <div class="form-group">
            <label for="password">Password*</label>
            <input type="password" id="password" name="password" required>
        </div>
        <div class="form-group">
            <label for="confirm_password">Confirm Password*</label>
            <input type="password" id="confirm_password" name="confirm_password" required>
        </div>
        <button type="submit">Register</button>
    </form>
    <p>Already have an account? <a href="{{ url_for('auth.login') }}">Login here</a></p>
</div>

<script>
let usernameTimeout;
let emailTimeout;

document.getElementById('username').addEventListener('input', function(e) {
    clearTimeout(usernameTimeout);
    const username = e.target.value;
    const messageDiv = document.getElementById('username-message');
    
    if (username.length >= 3) {
        usernameTimeout = setTimeout(() => {
            fetch(`/check_username/${username}`)
                .then(response => response.json())
                .then(data => {
                    if (data.available) {
                        e.target.classList.remove('invalid-input');
                        e.target.classList.add('valid-input');
                        messageDiv.innerHTML = 'Username is available';
                        messageDiv.classList.remove('invalid-message');
                        messageDiv.classList.add('valid-message');
                    } else {
                        e.target.classList.remove('valid-input');
                        e.target.classList.add('invalid-input');
                        messageDiv.innerHTML = 'Username is already taken';
                        messageDiv.classList.remove('valid-message');
                        messageDiv.classList.add('invalid-message');
                    }
                });
        }, 500);
    }
});

document.getElementById('email').addEventListener('input', function(e) {
    clearTimeout(emailTimeout);
    const email = e.target.value;
    const messageDiv = document.getElementById('email-message');
    
    if (email.includes('@')) {
        emailTimeout = setTimeout(() => {
            fetch(`/check_email/${email}`)
                .then(response => response.json())
                .then(data => {
                    if (data.available) {
                        e.target.classList.remove('invalid-input');
                        e.target.classList.add('valid-input');
                        messageDiv.innerHTML = 'Email is available';
                        messageDiv.classList.remove('invalid-message');
                        messageDiv.classList.add('valid-message');
                    } else {
                        e.target.classList.remove('valid-input');
                        e.target.classList.add('invalid-input');
                        messageDiv.innerHTML = 'Email is already registered';
                        messageDiv.classList.remove('valid-message');
                        messageDiv.classList.add('invalid-message');
                    }
                });
        }, 500);
    }
});
</script>
{% endblock %}